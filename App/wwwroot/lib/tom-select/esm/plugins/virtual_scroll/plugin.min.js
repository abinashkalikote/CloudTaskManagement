const accent_pat="[̀-ͯ·ʾʼ]",latin_convert={},latin_condensed={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let a in latin_condensed){let r=latin_condensed[a]||"";for(let t=0;t<r.length;t++){let e=r.substring(t,t+1);latin_convert[e]=a}}new RegExp(Object.keys(latin_convert).join("|")+"|"+accent_pat,"gu");const iterate=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)},addClasses=(e,...t)=>{var r=classesArray(t);(e=castAsArray(e)).map(t=>{r.map(e=>{t.classList.add(e)})})},classesArray=e=>{var t=[];return iterate(e,e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},castAsArray=e=>e=Array.isArray(e)?e:[e];function plugin(){const a=this,t=a.canLoad,e=a.clearActiveOption,s=a.loadCallback;var r,n,i={},l=!1,o=[];if(a.settings.shouldLoadMore||(a.settings.shouldLoadMore=()=>{if(.9<r.clientHeight/(r.scrollHeight-r.scrollTop))return!0;if(a.activeOption){var e=a.selectable();if(Array.from(e).indexOf(a.activeOption)>=e.length-2)return!0}return!1}),!a.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";a.settings.sortField=[{field:"$order"},{field:"$score"}];const c=e=>!("number"==typeof a.settings.maxOptions&&r.children.length>=a.settings.maxOptions)&&!!(e in i&&i[e]),d=(e,t)=>0<=a.items.indexOf(t)||0<=o.indexOf(t);a.setNextUrl=(e,t)=>{i[e]=t},a.getUrl=e=>{var t;return e in i?(t=i[e],i[e]=!1,t):(a.clearPagination(),a.settings.firstUrl.call(a,e))},a.clearPagination=()=>{i={}},a.hook("instead","clearActiveOption",()=>{if(!l)return e.call(a)}),a.hook("instead","canLoad",e=>e in i?c(e):t.call(a,e)),a.hook("instead","loadCallback",(e,t)=>{var r;l?n&&void 0!==(r=e[0])&&(n.dataset.value=r[a.settings.valueField]):a.clearOptions(d),s.call(a,e,t),l=!1}),a.hook("after","refreshOptions",()=>{var e,t=a.lastValue;c(t)?(e=a.render("loading_more",{query:t}))&&(e.setAttribute("data-selectable",""),n=e):t in i&&!r.querySelector(".no-results")&&(e=a.render("no_more_results",{query:t})),e&&(addClasses(e,a.settings.optionClass),r.append(e))}),a.on("initialize",()=>{o=Object.keys(a.options),r=a.dropdown_content,a.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},a.settings.render),r.addEventListener("scroll",()=>{!a.settings.shouldLoadMore.call(a)||c(a.lastValue)&&!l&&(l=!0,a.load.call(a,a.lastValue))})})}export{plugin as default};