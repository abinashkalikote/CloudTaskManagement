!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).virtual_scroll=t()}(this,function(){"use strict";const r={};var o,e={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(o in e){let t=e[o]||"";for(let e=0;e<t.length;e++){var s=t.substring(e,e+1);r[s]=o}}new RegExp(Object.keys(r).join("|")+"|[̀-ͯ·ʾʼ]","gu");const u=e=>{var t=[],r=e,o=e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))};if(Array.isArray(r))r.forEach(o);else for(var s in r)r.hasOwnProperty(s)&&o(r[s],s);return t.filter(Boolean)},f=e=>e=Array.isArray(e)?e:[e];return function(){const s=this,t=s.canLoad,e=s.clearActiveOption,o=s.loadCallback;var i,n,a={},l=!1,r=[];if(s.settings.shouldLoadMore||(s.settings.shouldLoadMore=()=>{if(.9<i.clientHeight/(i.scrollHeight-i.scrollTop))return!0;if(s.activeOption){var e=s.selectable();if(Array.from(e).indexOf(s.activeOption)>=e.length-2)return!0}return!1}),!s.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";s.settings.sortField=[{field:"$order"},{field:"$score"}];const d=e=>!("number"==typeof s.settings.maxOptions&&i.children.length>=s.settings.maxOptions)&&!!(e in a&&a[e]),c=(e,t)=>0<=s.items.indexOf(t)||0<=r.indexOf(t);s.setNextUrl=(e,t)=>{a[e]=t},s.getUrl=e=>{var t;return e in a?(t=a[e],a[e]=!1,t):(s.clearPagination(),s.settings.firstUrl.call(s,e))},s.clearPagination=()=>{a={}},s.hook("instead","clearActiveOption",()=>{if(!l)return e.call(s)}),s.hook("instead","canLoad",e=>e in a?d(e):t.call(s,e)),s.hook("instead","loadCallback",(e,t)=>{var r;l?n&&void 0!==(r=e[0])&&(n.dataset.value=r[s.settings.valueField]):s.clearOptions(c),o.call(s,e,t),l=!1}),s.hook("after","refreshOptions",()=>{var e,t,r,o=s.lastValue;d(o)?(e=s.render("loading_more",{query:o}))&&(e.setAttribute("data-selectable",""),n=e):o in a&&!i.querySelector(".no-results")&&(e=s.render("no_more_results",{query:o})),e&&(o=e,t=[s.settings.optionClass],r=u(t),(o=f(o)).map(t=>{r.map(e=>{t.classList.add(e)})}),i.append(e))}),s.on("initialize",()=>{r=Object.keys(s.options),i=s.dropdown_content,s.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},s.settings.render),i.addEventListener("scroll",()=>{!s.settings.shouldLoadMore.call(s)||d(s.lastValue)&&!l&&(l=!0,s.load.call(s,s.lastValue))})})}});